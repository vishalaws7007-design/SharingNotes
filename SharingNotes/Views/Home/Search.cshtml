@using System.Text.RegularExpressions
@model IEnumerable<Post>

<h2 class="mb-4">Search Results</h2>

@if (!Model.Any())
{
    <p class="text-muted">No results found.</p>
}
else
{
    <div class="d-flex flex-wrap gap-4 mt-4">
        @foreach (var data in Model)
        {
            <div class="card shadow-sm border-0 rounded-4" style="width: 18rem;">
                <div class="card-body d-flex flex-column">

                    <!-- Title -->
                    <h5 class="fw-bold">@data.Title</h5>

                    <!-- Short Description -->
                    <p class="text-muted small flex-grow-1">
                        @{
                            // Extract first <p> if HTML exists
                            var match = Regex.Match(data.Description ?? "", "<p>(.*?)</p>", RegexOptions.Singleline);
                            var firstPara = match.Success ? match.Groups[1].Value : data.Description ?? "";

                            // Remove HTML tags
                            var plain = Regex.Replace(firstPara, "<.*?>", "");

                            // Clean up spaces
                            plain = plain.Replace("&nbsp;", " ").Trim();

                            // Trim safely
                            var shortText = plain.Length > 120 ? plain.Substring(0, 120) + "..." : plain;
                        }
                        @shortText
                    </p>

                    <!-- Author -->
                    <p class="text-muted small mb-1">
                        <strong>Author:</strong> @data.userName
                    </p>

                    <!-- Views & Likes -->
                    <div class="small text-muted mb-2">
                        👁️ @data.ViewCount • 👍 @data.LikeCount
                    </div>

                    <!-- Read More Button -->
                    <a asp-controller="Home"
                       asp-action="ReadMore"
                       asp-route-id="@data.Id"
                       class="btn btn-secondary btn-sm mt-auto">
                        Read More
                    </a>
                </div>
            </div>
        }
    </div>
}